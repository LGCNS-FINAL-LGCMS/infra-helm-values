apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: lgcms-virtualservice
  namespace: backend
spec:
  gateways:
    - istio-system/lgcms-gateway
  hosts:
    - "*"
  http:
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
      - uri:
          regex: "^/api/.*/internal/.*"
      - uri:
          regex: "^/.*/internal/.*"
      directResponse:
        status: 403
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/auth"
        - uri:
            prefix: "/auth/"
        - uri:
            exact: "/student/auth"
        - uri:
            prefix: "/student/auth/"
        - uri:
            exact: "/lecturer/auth"
        - uri:
            prefix: "/lecturer/auth/"
        - uri:
            exact: "/admin/auth"
        - uri:
            prefix: "/admin/auth/"
      route:
        - destination:
            host: backend-auth.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/core"
        - uri:
            prefix: "/core/"
        - uri:
            exact: "/student/core"
        - uri:
            prefix: "/student/core/"
        - uri:
            exact: "/lecturer/core"
        - uri:
            prefix: "/lecturer/core/"
        - uri:
            exact: "/admin/core"
        - uri:
            prefix: "/admin/core/"
      route:
        - destination:
            host: backend-core.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/guide"
        - uri:
            prefix: "/guide/"
        - uri:
            exact: "/student/guide"
        - uri:
            prefix: "/student/guide/"
        - uri:
            exact: "/lecturer/guide"
        - uri:
            prefix: "/lecturer/guide/"
        - uri:
            exact: "/admin/guide"
        - uri:
            prefix: "/admin/guide/"
      route:
        - destination:
            host: backend-guide.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/lecture"
        - uri:
            prefix: "/lecture/"
        - uri:
            exact: "/student/lecture"
        - uri:
            prefix: "/student/lecture/"
        - uri:
            exact: "/lecturer/lecture"
        - uri:
            prefix: "/lecturer/lecture/"
        - uri:
            exact: "/admin/lecture"
        - uri:
            prefix: "/admin/lecture/"
      route:
        - destination:
            host: backend-lecture.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/member"
        - uri:
            prefix: "/member/"
        - uri:
            exact: "/student/member"
        - uri:
            prefix: "/student/member/"
        - uri:
            exact: "/lecturer/member"
        - uri:
            prefix: "/lecturer/member/"
        - uri:
            exact: "/admin/member"
        - uri:
            prefix: "/admin/member/"
      route:
        - destination:
            host: backend-member.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/lesson"
        - uri:
            prefix: "/lesson/"
        - uri:
            exact: "/student/lesson"
        - uri:
            prefix: "/student/lesson/"
        - uri:
            exact: "/lecturer/lesson"
        - uri:
            prefix: "/lecturer/lesson/"
        - uri:
            exact: "/admin/lesson"
        - uri:
            prefix: "/admin/lesson/"
      route:
        - destination:
            host: backend-lesson.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/upload"
        - uri:
            prefix: "/upload/"
        - uri:
            exact: "/student/upload"
        - uri:
            prefix: "/student/upload/"
        - uri:
            exact: "/lecturer/upload"
        - uri:
            prefix: "/lecturer/upload/"
        - uri:
            exact: "/admin/upload"
        - uri:
            prefix: "/admin/upload/"
      route:
        - destination:
            host: backend-upload.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/consulting"
        - uri:
            prefix: "/consulting/"
        - uri:
            exact: "/student/consulting"
        - uri:
            prefix: "/student/consulting/"
        - uri:
            exact: "/lecturer/consulting"
        - uri:
            prefix: "/lecturer/consulting/"
        - uri:
            exact: "/admin/consulting"
        - uri:
            prefix: "/admin/consulting/"
      route:
        - destination:
            host: backend-consulting.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/leveltest"
        - uri:
            prefix: "/leveltest/"
        - uri:
            exact: "/student/leveltest"
        - uri:
            prefix: "/student/leveltest/"
        - uri:
            exact: "/lecturer/leveltest"
        - uri:
            prefix: "/lecturer/leveltest/"
        - uri:
            exact: "/admin/leveltest"
        - uri:
            prefix: "/admin/leveltest/"
      route:
        - destination:
            host: backend-leveltest.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/payment"
        - uri:
            prefix: "/payment/"
        - uri:
            exact: "/student/payment"
        - uri:
            prefix: "/student/payment/"
        - uri:
            exact: "/lecturer/payment"
        - uri:
            prefix: "/lecturer/payment/"
        - uri:
            exact: "/admin/payment"
        - uri:
            prefix: "/admin/payment/"
      route:
        - destination:
            host: backend-payment.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/notification"
        - uri:
            prefix: "/notification/"
        - uri:
            exact: "/student/notification"
        - uri:
            prefix: "/student/notification/"
        - uri:
            exact: "/lecturer/notification"
        - uri:
            prefix: "/lecturer/notification/"
        - uri:
            exact: "/admin/notification"
        - uri:
            prefix: "/admin/notification/"
      route:
        - destination:
            host: backend-notification.backend.svc.cluster.local
            port:
              number: 8080
    - corsPolicy:
        allowCredentials: false
        allowHeaders:
        - Authorization
        - Content-Type
        - Accept
        - Origin
        - User-Agent
        allowMethods:
        - GET
        - POST
        - PUT
        - DELETE
        - PATCH
        - OPTIONS
        allowOrigins:
        - exact: "*"
        maxAge: "24h"
      match:
        - uri:
            exact: "/tutor"
        - uri:
            prefix: "/tutor/"
        - uri:
            exact: "/student/tutor"
        - uri:
            prefix: "/student/tutor/"
        - uri:
            exact: "/lecturer/tutor"
        - uri:
            prefix: "/lecturer/tutor/"
        - uri:
            exact: "/admin/tutor"
        - uri:
            prefix: "/admin/tutor/"
      route:
        - destination:
            host: backend-tutor.backend.svc.cluster.local
            port:
              number: 8080
